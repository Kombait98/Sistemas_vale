<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <title>Relatório de Conferência</title>
</head>
<body class="container-fluid mt-1">
    <%- include('partials/navbar') %>
    <div class="d-flex justify-content-between align-items-center">
        <h2>Gestão e Histórico de Autorizações</h2>
        <a href="/relatorio" class="btn btn-primary">Ir para Relatório Financeiro</a>
    </div>

    <table class="table table-hover mt-4 shadow-sm">
        <thead class="table-dark">
            <tr>
                <th>Usuário</th>
                <th>Data</th>
                <th>Trajeto</th>
                <th>Valor Total</th>
                <th>Estado Atual</th>
                <th class="text-center">Alterar Estado</th>
            </tr>
        </thead>
        <tbody>
            <% todosVales.forEach(v => { %>
                <tr class="<%= v.status === 2 ? 'opacity-75' : '' %>">
                    <td>
        <%= v.usuario %>
        <% if (v.motivo) { %>
            <i class="bi bi-chat-dots text-primary ms-1" 
           style="cursor: pointer;" 
           data-bs-toggle="tooltip" 
           data-bs-placement="top" 
           title="<%= v.motivo %>"></i>
        <% } %>
    </td>
                    <td><%= v.data %></td>
                    <td><%= v.nome_saida %> -> <%= v.nome_chegada %></td>
                    <td>R$ <%= (v.quantidade * v.valor_unitario).toFixed(2) %></td>
                    <td>
                        <% if (v.status === 0) { %>
                            <span class="badge bg-warning text-dark">Pendente</span>
                        <% } else if (v.status === 1) { %>
                            <span class="badge bg-success">Autorizado</span>
                        <% } else { %>
                            <span class="badge bg-danger">Recusado</span>
                        <% } %>
                    </td>
                    <td>
                        <div class="d-flex gap-1 justify-content-center">
                            <% if (v.status !== 0) { %>
                                <form action="/vales/status/<%= v.id %>/0" method="POST">
                                    <button class="btn btn-outline-warning btn-sm">Pendente</button>
                                </form>
                            <% } %>

                            <% if (v.status !== 1) { %>
                                <form action="/vales/status/<%= v.id %>/1" method="POST">
                                    <button class="btn btn-outline-success btn-sm">Autorizar</button>
                                </form>
                            <% } %>

                            <% if (v.status !== 2) { %>
                                <form action="/vales/status/<%= v.id %>/2" method="POST">
                                    <button class="btn btn-outline-danger btn-sm">Recusar</button>
                                </form>
                            <% } %>
                        </div>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>
    
    <div class="mt-4 mb-5">
        <a href="/" class="btn btn-secondary">Voltar ao Cadastro</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
</script>
</body>